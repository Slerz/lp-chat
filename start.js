const { spawn } = require('child_process');
const path = require('path');

console.log('üöÄ –ó–∞–ø—É—Å–∫ Shefport Chatbot...');

// –ó–∞–ø—É—Å–∫–∞–µ–º –±—ç–∫–µ–Ω–¥ OpenAI
const backend = spawn('node', ['openai-chat-backend.js'], {
  stdio: 'inherit',
  cwd: __dirname
});

// –ó–∞–ø—É—Å–∫–∞–µ–º PHP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–æ—Ä–º
const phpServer = spawn('php', ['-S', 'localhost:8000'], {
  stdio: 'inherit',
  cwd: path.join(__dirname, 'php')
});

// –ó–∞–ø—É—Å–∫–∞–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä —Å –ø—Ä–æ–∫—Å–∏
const webServer = spawn('node', ['node_modules/http-server/bin/http-server', '.', '-p', '8080', '--proxy', 'http://localhost:3001'], {
  stdio: 'inherit',
  cwd: __dirname
});

console.log('‚úÖ –ë—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:3001');
console.log('‚úÖ PHP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8000');
console.log('‚úÖ –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8080');
console.log('üåê –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8080');

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
process.on('SIGINT', () => {
  console.log('\nüõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤...');
  backend.kill();
  phpServer.kill();
  webServer.kill();
  process.exit();
});

backend.on('close', (code) => {
  console.log(`–ë—ç–∫–µ–Ω–¥ –∑–∞–≤–µ—Ä—à–µ–Ω —Å –∫–æ–¥–æ–º ${code}`);
});

phpServer.on('close', (code) => {
  console.log(`PHP —Å–µ—Ä–≤–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω —Å –∫–æ–¥–æ–º ${code}`);
});

webServer.on('close', (code) => {
  console.log(`–í–µ–±-—Å–µ—Ä–≤–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω —Å –∫–æ–¥–æ–º ${code}`);
}); 